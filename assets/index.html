<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        .text {
            font-size: 14px;
        }

        .item {
            margin-bottom: 5px;
        }

        .clearfix:before,
        .clearfix:after {
            display: table;
            content: "";
        }

        .clearfix:after {
            clear: both
        }

        .box-card {
            width: 100%;
            margin-bottom: 10px;
        }

        .card-right {
            float: right;
            padding: 3px 0
        }

        .tag-box {
            padding-left: 3px;
            padding-right: 3px;
            display: inline;
        }

        .tag-box-item {
            margin-left: 3px;
            margin-right: 3px;
        }
    </style>
</head>

<body>
    <div id="app">
        <el-card class="box-card" shadow="always">
            <div slot="header" class="clearfix">
                <span>CPU</span>
                <span class="tag-box card-right">
                    <el-tag type="info" class="tag-box-item">{{info.CPU[0].ModelName}}</el-tag>
                    <el-tag type="info" class="tag-box-item">{{info.CPU[0].Cores}} Cores</el-tag>
                </span>
            </div>
            <div class="item">
                <canvas id="smoothie-chart-cpu" style="width:100%; height:200px">
            </div>
        </el-card>
        <el-card class="box-card" shadow="always">
            <div slot="header" class="clearfix">
                <span>Load</span>
                <span class="tag-box card-right">
                    <el-tag type="info" class="tag-box-item">Load1: {{info.Load.load1}}</el-tag>
                    <el-tag type="info" class="tag-box-item">Load5: {{info.Load.load5}}</el-tag>
                    <el-tag type="info" class="tag-box-item">Load15: {{info.Load.load15}}</el-tag>
                </span>
            </div>
            <div class="item">
                <canvas id="smoothie-chart-load" style="width:100%; height:200px">
            </div>
        </el-card>


        <el-card class="box-card" shadow="always">
            <div slot="header" class="clearfix">
                <span>Mem</span>
                <span class="tag-box card-right">
                    <el-tag type="info" class="tag-box-item">Total: {{info.Mem.Total | prettyBytes}}</el-tag>
                    <el-tag type="info" class="tag-box-item">Used: {{info.Mem.Used | prettyBytes}}</el-tag>
                    <el-tag type="info" class="tag-box-item">Available: {{info.Mem.Available | prettyBytes}}</el-tag>
                </span>
            </div>
            <div class="item">
                <canvas id="smoothie-chart-mem" style="width:100%; height:200px">
            </div>
        </el-card>

        <el-card class="box-card" shadow="always">
            <div slot="header" class="clearfix">
                <span>Swap</span>
                <span class="tag-box card-right">
                    <el-tag type="info" class="tag-box-item">Total: {{info.Swap.Total | prettyBytes}}</el-tag>
                    <el-tag type="info" class="tag-box-item">Used: {{info.Swap.Used | prettyBytes}}</el-tag>
                    <el-tag type="info" class="tag-box-item">Available: {{info.Swap.Available | prettyBytes}}</el-tag>
                </span>
            </div>
            <div class="item">
                <canvas id="smoothie-chart-swap" style="width:100%; height:200px">
            </div>
        </el-card>

        <el-card class="box-card" shadow="always">
            <div slot="header" class="clearfix">
                <span>Disk</span>
                <span class="tag-box card-right">
                    <el-tag type="info" class="tag-box-item">BootTime: {{info.BootTime | localdateformat}}</el-tag>
                    <el-tag type="info" class="tag-box-item">UpTime: {{info.Uptime | durationstr}}</el-tag>
                </span>
            </div>
            <div class="item">
                <canvas id="smoothie-chart-disk" style="width:100%; height:200px">
            </div>
        </el-card>

        <el-card v-for="(value, key) in info.Network" class="box-card" shadow="always">
            <div slot="header" class="clearfix">
                <span>Interface {{key}}</span>
                <span class="tag-box card-right">
                    <el-tag type="info" v-for="ip in value.Addrs" class="tag-box-item">{{ip}}</el-tag>
                    <el-tag class="tag-box-item"><span class="el-icon-upload2"></span> {{value.SentSpeed |
                        prettyBytes}}/s</el-tag>
                    <el-tag class="tag-box-item"><span class="el-icon-download"></span> {{value.RecvSpeed |
                        prettyBytes}}/s</el-tag>
                    <el-tag type="info" class="tag-box-item"><span class="el-icon-upload2"></span> {{value.ByteSent |
                        prettyBytes}}</el-tag>
                    <el-tag type="info" class="tag-box-item"><span class="el-icon-download"></span> {{value.ByteRecv |
                        prettyBytes}}</el-tag>
                </span>
            </div>
            <div class="item">
                none
            </div>
        </el-card>
    </div>
</body>
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/smoothie/1.34.0/smoothie.min.js" integrity="sha256-s4pCizM36ibu/qMLSJHZLwhA5sV0/Jn1J/1TrzryEKQ="
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js" integrity="sha256-AdQN98MVZs44Eq2yTwtoKufhnU+uZ7v2kXnD5vqzZVo="
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-duration-format/2.2.2/moment-duration-format.min.js"
    integrity="sha256-bXC/nhRjq/J7K4hnL8yvthqXkskSKOsZNfrLgXBigYg=" crossorigin="anonymous"></script>
<script>
    vm = new Vue({
        el: '#app',
        data: function () {
            return {
                info: {
                    "Percent": {
                        "CPU": 0,
                        "Disk": 0,
                        "Mem": 0,
                        "Swap": 0
                    },
                    "CPU": [
                        { "ModelName": "CPU Model", "Cores": 0 }
                    ],
                    "Mem": {
                        "Total": 0,
                        "Used": 0,
                        "Available": 0
                    },
                    "Swap": {
                        "Total": 0,
                        "Used": 0,
                        "Available": 0
                    },
                    "Load": {
                        "load1": 0,
                        "load5": 0,
                        "load15": 0
                    },
                    "Network": {
                        "Interface Name": {
                            "Addrs": ["IP address"],
                            "ByteSent": 0,
                            "ByteRecv": 0,
                            "SentSpeed": 0,
                            "RecvSpeed": 0
                        }
                    },
                    "BootTime": 0,
                    "Uptime": 0
                },
                refreshIntervalId: 0,
                tsCPU: new TimeSeries(),
                tsMem: new TimeSeries(),
                tsSwap: new TimeSeries(),
                tsDisk: new TimeSeries(),
                tsLoad1: new TimeSeries(),
                tsLoad5: new TimeSeries(),
                tsLoad15: new TimeSeries(),
            };
        },
        filters: {
            toFix2: function (value) {
                return Number(value).toFixed(2);
            },
            toRound: function (value) {
                return Math.round(value);
            },
            prettyBytes: function (num) {
                // jacked from: https://github.com/sindresorhus/pretty-bytes
                if (typeof num !== 'number' || isNaN(num)) {
                    throw new TypeError('Expected a number');
                }
                var exponent;
                var unit;
                var neg = num < 0;
                var units = ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
                if (neg) {
                    num = -num;
                }
                if (num < 1) {
                    return (neg ? '-' : '') + num + ' B';
                }
                exponent = Math.min(Math.floor(Math.log(num) / Math.log(1000)), units.length - 1);
                num = (num / Math.pow(1000, exponent)).toFixed(2) * 1;
                unit = units[exponent];
                return (neg ? '-' : '') + num + ' ' + unit;
            },
            localdateformat: function (date) {
                return moment(date, "X").format('LLL');
            },
            durationstr: function (seconds) {
                return moment.duration(seconds, "seconds").format();
            }
        },
        created() {
            this.fetchServerStatus()
            this.refreshIntervalId = setInterval(() => {
                this.fetchServerStatus()
            }, 1500)
        },
        beforeDestroy() {
            clearInterval(this.refreshIntervalId)
        },
        mounted() {
            var chartCPU = new SmoothieChart({ responsive: true, maxValue: 100, minValue: 0 });
            chartCPU.addTimeSeries(this.tsCPU, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 4 });
            chartCPU.streamTo(document.getElementById("smoothie-chart-cpu"), 1500);
            var chartLoad = new SmoothieChart({ responsive: true, minValue: 0 });
            chartLoad.addTimeSeries(this.tsLoad1, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 4 });
            chartLoad.addTimeSeries(this.tsLoad5, { strokeStyle: 'rgba(255, 0, 1)', fillStyle: 'rgba(255, 0, 0, 0.2)', lineWidth: 4 });
            chartLoad.addTimeSeries(this.tsLoad15, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0, 0, 255, 0.2)', lineWidth: 4 });
            chartLoad.streamTo(document.getElementById("smoothie-chart-load"), 1500);
            var chartMem = new SmoothieChart({ responsive: true, maxValue: 100, minValue: 0 });
            chartMem.addTimeSeries(this.tsMem, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 4 });
            chartMem.streamTo(document.getElementById("smoothie-chart-mem"), 1500);
            var chartSwap = new SmoothieChart({ responsive: true, maxValue: 100, minValue: 0 });
            chartSwap.addTimeSeries(this.tsSwap, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 4 });
            chartSwap.streamTo(document.getElementById("smoothie-chart-swap"), 1500);
            var chartDisk = new SmoothieChart({ responsive: true, maxValue: 100, minValue: 0 });
            chartDisk.addTimeSeries(this.tsDisk, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 4 });
            chartDisk.streamTo(document.getElementById("smoothie-chart-disk"), 1500);
        },
        methods: {
            fetchServerStatus: function () {
                this.$http.get('/info').then((response) => {
                    this.info = response.body;
                    t = new Date().getTime();
                    this.tsCPU.append(t, this.info.Percent.CPU);
                    this.tsMem.append(t, this.info.Percent.Mem);
                    this.tsSwap.append(t, this.info.Percent.Swap);
                    this.tsDisk.append(t, this.info.Percent.Disk);
                    this.tsLoad1.append(t, this.info.Load.load1);
                    this.tsLoad5.append(t, this.info.Load.load5);
                    this.tsLoad15.append(t, this.info.Load.load15);
                });
            }
        }
    })
</script>

</html>